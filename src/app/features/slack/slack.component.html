<div class="card fade-in">
  <div class="card-header">
    <div class="card-title"><div class="dot" style="background: #4a154b"></div>Slack</div>
    @if (slackData()) {
      <div class="workspace-tag">{{ slackData()!.workspace }}</div>
    }
  </div>

  @if (!isConfigured()) {
    <div class="empty" style="padding: 40px 20px">
      <div style="font-size: 24px; margin-bottom: 12px">üí¨</div>
      <div style="font-weight: 600; margin-bottom: 8px">Slack –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω</div>
      <div style="color: var(--muted); font-size: 11px">–î–æ–±–∞–≤—å—Ç–µ Bot Token –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</div>
    </div>
  } @else if (isLoading()) {
    <app-skeleton-loader [count]="5" />
  } @else if (isError()) {
    <div class="empty" style="padding: 32px 20px">
      <div style="font-size: 20px; margin-bottom: 8px">‚ö†Ô∏è</div>
      <div style="color: var(--red); font-weight: 600; margin-bottom: 6px">{{ slackError()!.error }}</div>
      <div style="color: var(--muted); font-size: 11px">{{ errorHint() }}</div>
    </div>
  } @else if (hasData()) {
    <div class="tabs">
      <div class="tab" [class.active]="filter() === 'all'" (click)="setFilter('all')">–í—Å–µ</div>
      <div class="tab" [class.active]="filter() === 'dms'" (click)="setFilter('dms')">DMs</div>
      <div class="tab" [class.active]="filter() === 'mentions'" (click)="setFilter('mentions')">–£–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
      <div class="tab" [class.active]="filter() === 'unreads'" (click)="setFilter('unreads')">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</div>
    </div>
    <div class="card-body">
      @if (messages().length === 0) {
        <div class="empty">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
      } @else {
        @for (msg of messages(); track msg.id) {
          <div class="slack-row" (click)="replyChannel.set(msg.channelId)">
            <div class="slack-avatar">
              @if (msg.avatar) { <img [src]="msg.avatar" [alt]="msg.from || ''" /> }
              @else { {{ (msg.channelName || 'S').slice(0,2).toUpperCase() }} }
            </div>
            <div class="slack-body">
              <div class="slack-meta">
                <span class="slack-channel">{{ msg.channelName }}</span>
                @if (msg.from) { <span class="slack-from">{{ msg.from }}</span> }
                <span class="slack-time">{{ msg.ts | smartTime }}</span>
              </div>
              <div class="slack-text">{{ msg.text }}</div>
            </div>
          </div>
        }
      }
    </div>
    @if (replyChannel()) {
      <div class="compose-row">
        <input class="compose-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." [value]="messageText()" (input)="onTextInput($event)" (keydown.enter)="sendMessage()" />
        <button class="compose-btn" (click)="sendMessage()">‚Üí</button>
      </div>
    }
  }
</div>
